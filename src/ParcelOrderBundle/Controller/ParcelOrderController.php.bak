<?php

namespace ParcelOrderBundle\Controller;
use FOS\RestBundle\Controller\FOSRestController;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use ParcelOrderBundle\Repository\ParcelOrderRepository;

class ParcelOrderController extends FOSRestController 
{
	public function getParcelsAction() {
		return $this->getDoctrine()->getRepository('ParcelOrderBundle:ParcelOrder')
		->findAll();
	}
	public function getParcelAction($id) {
		return $this->getDoctrine()->getRepository('ParcelOrderBundle:ParcelOrder')
		->find($id);
	}
	//stworzyć paczkę na jak w lab3
	public function postParcelOrderAction(Request $request) 
	{
		var_dump($request);
		try {
				
				$pocz=1;
				$kon=9999;
				$los=rand($pocz,$kon);
				
				$request->request->set('parcelOrderHash',$los);
				$newParcelOrder = $this->container->get('parcel_rest.parcel_form.handler')
				->post(
				$request->request->all()
				);
				
				$routeOptions = array(
				'id' => $newParcelOrder->getId(),
				'_format' => $request->get('_format')
				);
				return $this->routeRedirectView('api_1_get_parcel', $routeOptions,
				Response::HTTP_CREATED);
			} 
			catch (InvalidFormException $exception) {
				return array('form' => $exception->getForm());
			}
	}
	
	public function deleteParcelOrderAction(Request $request, $id) { }
}